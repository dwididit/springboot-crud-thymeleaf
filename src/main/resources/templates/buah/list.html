<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Buah Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-4">
    <h2>Buah Management</h2>
    <a href="/buah/create" class="btn btn-primary mb-3">Add New Buah</a>

    <div class="alert alert-success" th:if="${success}" th:text="${success}"></div>
    <div class="alert alert-danger" th:if="${error}" th:text="${error}"></div>

    <table class="table table-striped">
        <thead>
        <tr>
            <th>ID</th>
            <th>Nama Buah</th>
            <th>Deskripsi</th>
            <th>Harga</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="buah : ${buahList}">
            <td th:text="${buah.buahId}"></td>
            <td th:text="${buah.namaBuah}"></td>
            <td th:text="${buah.deskripsi}"></td>
            <td th:text="${buah.harga}"></td>
            <td>
                <a th:href="@{/buah/edit/{id}(id=${buah.buahId})}" class="btn btn-warning btn-sm">Edit</a>
                <button class="btn btn-danger btn-sm"
                        onclick="deleteBuah(this.getAttribute('data-id'))"
                        th:data-id="${buah.buahId}">Delete</button>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<script>
    function deleteBuah(buahId) {
        if (confirm('Are you sure you want to delete this buah?')) {
            fetch(`/api/buah/delete/${buahId}`, {
                method: 'DELETE'
            })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 200) {
                        location.reload();
                    } else {
                        alert('Error deleting buah');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error deleting buah');
                });
        }
    }
</script>
</body>
</html>

<!-- templates/buah/form.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Buah Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-4">
    <h2 th:text="${buah != null ? 'Edit Buah' : 'Create New Buah'}"></h2>

    <form id="buahForm" class="mt-3">
        <input type="hidden" id="buahId" th:value="${buah != null ? buah.buahId : ''}">

        <div class="mb-3">
            <label for="namaBuah" class="form-label">Nama Buah</label>
            <input type="text" class="form-control" id="namaBuah"
                   th:value="${buah != null ? buah.namaBuah : ''}" required>
        </div>

        <div class="mb-3">
            <label for="deskripsi" class="form-label">Deskripsi</label>
            <textarea class="form-control" id="deskripsi" rows="3"
                      th:text="${buah != null ? buah.deskripsi : ''}" required></textarea>
        </div>

        <div class="mb-3">
            <label for="harga" class="form-label">Harga</label>
            <input type="number" class="form-control" id="harga"
                   th:value="${buah != null ? buah.harga : ''}" required>
        </div>

        <button type="submit" class="btn btn-primary">Save</button>
        <a href="/buah" class="btn btn-secondary">Cancel</a>
    </form>
</div>

<script>
    document.getElementById('buahForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const buahId = document.getElementById('buahId').value;
        const data = {
            namaBuah: document.getElementById('namaBuah').value,
            deskripsi: document.getElementById('deskripsi').value,
            harga: parseFloat(document.getElementById('harga').value)
        };

        const url = buahId ? `/api/buah/edit/${buahId}` : '/api/buah/create';
        const method = buahId ? 'PUT' : 'POST';

        fetch(url, {
            method: method,
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
            .then(response => response.json())
            .then(data => {
                if (data.status === 200 || data.status === 201) {
                    window.location.href = '/buah';
                } else {
                    alert('Error saving buah');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error saving buah');
            });
    });
</script>
</body>
</html>